# Link-back

Сервер для предоставления, редактирования и хранения информации об аккаунт-менеджеров, рекламодателях и их компаниях с получением информации из внешней базы данных, как через интерфейсы API, так и через CRON задачи.

## Начало работы

1. Для начала работы необходимо проинициализировать базу данных через пред настроенный дамп базы данных по директории ./src/utils/dump-202402021502.sql или загрузке миграции по команде:

```
npm run migration:run
```

Во втором случае инициализируется только схема, без данных.

2. Пред настройка параметров для инициализации из примера example.env, параметры подключения к базе данных сервиса. Для подключения к базе данных статистики рекламодателей необходимо прописать параметры доступа, которые определяется постфиксом STAT.

3. Запуск через NodeJS:

```
# Установка
$ npm i

# Сборка
$ npm build

# запуск админ панели
$ npm run start:prod

```

4. Запуск через Docker:

```
$ docker run -d -p 3002:3002 -v link-backend:/app/upload --env-file ./.env --network=vast-network --add-host=mysqldb:172.20.0.3 --name link_back repo.synaptik.ru:5050/petrov/link-bakck:master node ./dist/src/main.js
```

## Архитектура сервера

Исходный код проекта хранится в директории ./src внутри, которой предопределены следующие директории:

- ../common - для хранения и использования интерфейсов, сервисов, конфигураций и декораторов во всем проекте;
- ../database - хранит в себе описание и использование сущностей из базы данных сервиса и по пути ./stats описание данных из базы данных статистики;
- ../modules - внутри распределены файлы с описанием контроллера, сервиса, модуля и интерфейсы DTO для каждого модуля системы;

Методы описаны в Swagger по пути: \*/doc, при включении описании

```
SWITCH_SWAGGER = true
```

в .env файле

## Работа сервера

Для работы с интерфейсом необходимо пройти авторизацию по почте и паролю, в результате чего можно получить JWT токен, который предоставляет доступ к методам, который используется в заголовке запроса: "Authorization: Bearer \*".

В системе присутствует разделение пользователей по ролям, которая ограничивает область использования методов у отдельных пользователей описанные в enum по директории src\common\enums\role.enum.ts , которые определяется декораторами:

```
  @UseGuards()
  @Roles()
```

Разделение прав:

- Администратор - может использовать все методы сервера, включая работу с: аккаунт-менеджерами системы, с рекламодателями, их статистикой и кампаниями;
- Аккаунт менеджер - имеет доступ к рекламодателям их статистике и кампаниям, к которым привязал его администратор;
- Рекламодатель - просмотр статистики

Сервер использует cron сервис для обновление данных статистики, рекламодателей и их кампании;

## Автор

- **Петров Максим** - _Разработка_ - _link-back_
